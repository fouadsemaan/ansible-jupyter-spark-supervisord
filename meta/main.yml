---
galaxy_info:
  author: Andrew Rothstein
  description: installs supervisord conf for a jupyter notebook
  company: BlackRock
  license:
    - MIT
  min_ansible_version: 2.0
  platforms:
    - name: EL
      versions:
        - all
    - name: Fedora
      versions:
        - all
    - name: Ubuntu
      versions:
        - all
    - name: Alpine
      versions:
        - all
    - name: MacOSX
      versions:
        - all
  galaxy_tags:
    - python
    - jupyter
    - supervisord

dependencies:
  - role: andrewrothstein.java-openjdk-jre
    version: v1.0.0
  - role: fouadsemaan.spark
    version: v2.0.3
    spark_mirror_url: '{{spark_mirror_url}}'
    spark_timeout: '{{spark_timeout}}'
    jupyter_supervisord_username: '{{jupyter_supervisord_username}}'
    jupyter_supervisord_notebook_dir: '{{jupyter_supervisord_notebook_dir}}'
    jupyter_supervisord_profile_py: '{{jupyter_supervisord_profile_py}}'
    spark_envs:
      PYTHONPATH : '{{PYTHONPATH}}'
      SPARK_OPTS : '{{SPARK_OPTS}}'
      HADOOP_CONF_DIR : '{{HADOOP_CONF_DIR}}'
      PYSPARK_DRIVER_PYTHON : '{{PYSPARK_DRIVER_PYTHON}}'
      PYTHON : '{{PYTHON}}}'
      PYTHONHASHSEED : '{{PYTHONHASHSEED}}'
      PYSPARK_PYTHON : '{{PYSPARK_PYTHON}}'
      PYSPARK_DRIVER_PYTHON_OPTS : 'notebook --config={{jupyter_supervisord_profile_py}} --Session.username={{jupyter_supervisord_username}} {% if jupyter_supervisord_notebook_dir is defined %} --NotebookApp.notebook_dir={{jupyter_supervisord_notebook_dir}} {% endif %}'
  - role: andrewrothstein.jupyter-profile
    version: v3.1.5
    jupyter_profile_name: '{{jupyter_supervisord_name}}'
    jupyter_profile_environment: '{{jupyter_supervisord_environment}}'
    jupyter_profile_conda_cleanup: '{{jupyter_supervisord_conda_cleanup}}'
  - role: andrewrothstein.supervisord-program
    version: v1.0.3
    supervisord_program_name: jupyter
    supervisord_program_command: /usr/local/bin/run-jupyter-notebook.sh
    supervisord_username: '{{jupyter_supervisord_username}}'
